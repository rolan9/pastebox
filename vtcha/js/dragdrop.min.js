/**
 * dragdrop.js
 * http://www.codrops.com
 *
 * Licensed under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 * 
 * Copyright 2014, Codrops
 * http://www.codrops.com
 */
!function(){"use strict";function t(t,i,e){i||(i=250);var o,s;return function(){var n=e||this,l=+new Date,r=arguments;o&&o+i>l?(clearTimeout(s),s=setTimeout(function(){o=l,t.apply(n,r)},i)):(o=l,t.apply(n,r))}}function i(){var t=c.clientHeight,i=window.innerHeight;return i>t?i:t}function e(){return window.pageXOffset||c.scrollLeft}function o(){return window.pageYOffset||c.scrollTop}function s(t){var i=t.getBoundingClientRect();return{top:i.top+o(),left:i.left+e()}}function n(t,i){t.style.transform=i}function l(t,i){var e=function(){u.transitions&&this.removeEventListener(d,e),i&&"function"==typeof i&&i.call()};u.transitions?t.addEventListener(d,e):e()}function r(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e]);return t}function p(t,i){this.el=t,this.options=r({},this.options),r(this.options,i)}function h(t,i,e){this.el=t,this.options=r({},this.options),r(this.options,e),this.droppables=i,this.scrollableEl=this.options.scrollable===window?window:document.querySelector(this.options.scrollable),this.scrollIncrement=0,this.options.helper&&(this.offset={left:s(this.el).left,top:s(this.el).top}),this.draggie=new Draggabilly(this.el,this.options.draggabilly),this.initEvents()}var a=document.body,c=window.document.documentElement,f={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},d=f[Modernizr.prefixed("transition")],u={transitions:Modernizr.csstransitions},g=!!getStyleProperty("perspective");p.prototype.options={onDrop:function(){return!1}},p.prototype.isDroppable=function(t){var i=s(t),e=t.offsetWidth,o=t.offsetHeight,n=s(this.el),l=this.el.offsetWidth,r=this.el.offsetHeight;return!(n.left>i.left+e-e/2||n.left+l<i.left+e/2||n.top>i.top+o-o/2||n.top+r<i.top+o/2)},p.prototype.highlight=function(t){this.isDroppable(t)?classie.add(this.el,"highlight"):classie.remove(this.el,"highlight")},p.prototype.collect=function(t){classie.remove(this.el,"highlight"),this.options.onDrop(this,t)},h.prototype.options={scroll:!1,scrollable:window,scrollSpeed:20,scrollSensitivity:10,draggabilly:{},animBack:!0,helper:!1,onStart:function(){return!1},onDrag:function(){return!1},onEnd:function(){return!1}},h.prototype.initEvents=function(){this.draggie.on("dragStart",this.onDragStart.bind(this)),this.draggie.on("dragMove",t(this.onDragMove.bind(this),5)),this.draggie.on("dragEnd",this.onDragEnd.bind(this))},h.prototype.onDragStart=function(t){this.options.onStart(),this.position={left:t.position.x,top:t.position.y},this.options.helper&&this.createHelper(t.element),classie.add(t.element,"is-active"),this.highlightDroppables()},h.prototype.onDragMove=function(t){this.options.onDrag(),this.options.scroll&&this.scrollPage(t.element),this.highlightDroppables()},h.prototype.onDragEnd=function(t){this.options.helper&&(t.element.style.left=t.position.x+this.position.left+"px",t.element.style.top=t.position.y+this.position.top+"px"),this.options.scroll&&(this.scrollIncrement=0);for(var i=!1,e=0,o=this.droppables.length;o>e;++e){var s=this.droppables[e];s.isDroppable(t.element)&&(i=!0,s.collect(t.element))}this.options.onEnd(i);var n=!0;i&&(classie.add(t.element,"is-dropped"),setTimeout(function(){classie.add(t.element,"is-complete"),l(t.element,function(){classie.remove(t.element,"is-complete"),classie.remove(t.element,"is-dropped")})},25)),(this.position.left===t.position.x&&this.position.top===t.position.y||i)&&(n=!1),this.moveBack(n)},h.prototype.highlightDroppables=function(){for(var t=0,i=this.droppables.length;i>t;++t)this.droppables[t].highlight(this.el)},h.prototype.createHelper=function(){var t=this.el.cloneNode(!0);classie.remove(t,"is-dragging"),this.el.parentNode.replaceChild(t,this.el);var i=new h(t,this.droppables,this.options);classie.add(this.el,"helper"),this.el.style.left=i.offset.left+"px",this.el.style.top=i.offset.top+"px",this.position.left=i.offset.left,this.position.top=i.offset.top,a.appendChild(this.el)},h.prototype.moveBack=function(t){var i=this.options.animBack&&t;i&&classie.add(this.el,"animate"),n(this.el,g?"translate3d(0,0,0)":"translate(0,0)"),this.el.style.left=this.position.left+"px",this.el.style.top=this.position.top+"px";var e=function(){i&&classie.remove(this.el,"animate"),classie.remove(this.el,"is-active"),this.options.helper&&a.removeChild(this.el)}.bind(this);i?l(this.el,e):e()},h.prototype.outViewport=function(){var t=Math.abs(this.options.scrollSensitivity)||0,e=o(),n=e+i(),l=s(this.el).top,r=(l+this.el.offsetHeight/2,l+this.el.offsetHeight+t>n),p=e>l-t;return r?this.scrolldir="down":p&&(this.scrolldir="up"),r||p},h.prototype.scrollPage=function(){this.outViewport(this.el)?this.doScroll():this.scrollIncrement=0},h.prototype.doScroll=function(){var t=this.options.scrollSpeed||20;this.scrollIncrement++;var i=this.scrollIncrement<t?this.scrollIncrement:t;this.scrollableEl===window?this.scrollableEl.scrollBy(0,"up"===this.scrolldir?-1*i:i):this.scrollableEl.scrollTop+="up"===this.scrolldir?-1*i:i},window.Droppable=p,window.Draggable=h}();
